---
Title: Οπτική βελτίωση σκιασμένου αναγλύφου εδάφους
Date: 2013-02-13 00:10
Category: GIS
Tags: dem , gdaldem , gdalwrap , GIMP , σκίαση εδάφους
---


Παρακάτω προτείνεται μια μεθοδολογία με εργαλεία ΕΛ/ΛΑΚ, για την οπτική βελτίωση μιας σκίασης αναγλύφου εδάφους.

Το λογισμικό που απαιτείται είναι το [gdaldem](http://www.gdal.org/gdaldem.html), [gdalwrap](http://www.gdal.org/gdalwarp.html) και το [GIMP](https://www.gimp.org/).

Τα κλασσικά προγράμματα ΣΓΠ αναπαριστούν την σκίαση αναγλύφου με τρόπο μονότονο, συχνά μη φυσικό και με περιττή πληροφορία για τον αναγνώστη.

Στόχος είναι να εφαρμόσουμε μια τεχνική που πρώτος εφάρμοσε ο [Eduard Imhof](http://www.reliefshading.com/cartographers/imhof.html), την αναπαράσταση του αναγλύφου με θέαση αφ' ύψηλου (aerial perspective). Η συγκεκριμένη τεχνική του Imhof προσομοιάζει την πραγματική, αφ' υψηλού οπτική ενός τοπίου όπου ο θεατής βλέπει τις κορυφές με περισσότερη λεπτομέρεια και έντονη αντίθεση και τις περιοχές χαμηλότερου υψομέτρου με λιγότερη λεπτομέρεια λόγω απόστασης και ομίχλης στο τοπίο. Η τεχνική που ακολουθεί απαιτεί:

1. Ένα Ψηφιακό Μοντέλο Εδάφους (DEM)

2. Σκίαση του ανωτέρω DEM με διπλάσια κάθετη υπερβολή του υψομέτρου (z exaggeration).

3. Σκίαση του ανωτέρω DEM με διπλάσια κάθετη υπερβολή του υψομέτρου (z exaggeration) και πηγή φωτός σε γωνία 90 μοιρών.

4. Τεχνικές θαμπώματος (blur) για την εξομάλυνση και την απαλοιφή της περιττής πληροφορίας του DEM.

5. Οπτική ενίσχυση των ορεινών όγκων και μίξη του αποτελέσματος με την σκίαση.

Παρακάτω φαίνεται η σύγκριση μεταξύ μίας τυπικής σκίασης αναγλύφου και της σκίασης που προκύπτει μετά την προτεινόμενη μέθοδο απεικόνισης και επεξεργασίας.


<img src={static}images/aster_ggrs.hillshade.z1.jpg  title="Τυπική σκίαση αναγλύφου" width="400"> <img src={static}images/dem_final.jpg  width="400"  title="Σκίαση αναγλύφου κατόπιν επεξεργασίας">


### ΠΕΡΙΓΡΑΦΗ ΤΗΣ ΜΕΘΟΔΟΥ


Κατεβάζουμε από την ιστοσελίδα <http://gdem.ersdac.jspacesystems.or.jp/search.jsp> το απαραίτητο Dem προς επεξεργασία στην περίπτωσή μας το: ASTGTM2_N39E020.zip

Ακολουθεί αποσυμπίεση του συμπιεσμένου αρχείου με:

```
unzip -j ASTGTM2_N39E020.zip
```

Μετατροπή του DEM στο ΕΓΣΑ'87 με:

```
gdalwarp -t_srs EPSG:2100 -s_srs EPSG:4326 ASTGTM2_N39E020_dem.tif aster_GGRS.tif -r bilinear
```

Κρίσιμη επίδραση στην οπτική απόδοση της σκίασης του αναγλύφου έχει η παράμετρος της κάθετης υπερβολής (z exaggeration) του υψομέτρου, η οποία ορίζεται στο διπλάσιο.


Υπολογισμός σκίασης του ανωτέρω DEM με διπλάσια κάθετη υπερβολή του υψομέτρου:

```
gdaldem hillshade aster_GGRS.tif aster_GGRS.hillshade.z2.tif -z 2
```


Υπολογισμός σκίασης του ανωτέρω DEM με διπλάσια κάθετη υπερβολή του υψομέτρου (z exaggeration) και με ύψος φωτεινής πηγής 90 μοίρες:

```
gdaldem hillshade aster_GGRS.tif aster_GGRS.x2.alt90.tif -z 2 -alt 90 -compute_edges
```

### ΕΠΕΞΕΡΓΑΣΙΑ ΣΤΟ GIMP

1. Γενίκευση της σκίασης και τεχνικές θαμπώματος (blur)

Ανοίγουμε στο GIMP το αρχείο aster_GGRS.hillshade.z2.tif με σκοπό αρχικά να μειώσουμε τον "θορυβο" και την περιττή πληροφορία, να γενικεύσουμε την επιφάνεια. Ένα κατάλληλο εργαλείο γι' αυτή την επεξεργασία είναι το [Simple surface blur/bilateral filter](http://registry.gimp.org/node/24208), το οποίο απαιτεί ειδική εγκατάσταση στο GIMP.


Επιλέγουμε *Filters->Blur->Simple Bilateral* και ορίζουμε τιμές:


Size:79


Threshold:118


Οι τιμές είναι ενδεικτικές και προκύπτουν μετά από δοκιμές, ανάλογα την επίδραση στο τελικό αποτέλεσμα.


Επιλέγουμε *Filters->Blur->Gaussian Blur* και ορίζουμε τιμές στο Blur Radius:


Horizontal:3


Vertical:3

![]({static}images/gaussian_blur.jpg)


Μπορούμε να συνεχίσουμε την αφαίρεση "θορύβου" με το φίλτρο Despeckle (Filters > Enhance > Despeckle) όπου δίνουμε τις παραμέτρους της παρακάτω εικόνας:
![]({static}images/despeckle.jpg)


2. Οπτική ενίσχυση του αναγλύφου με βάση το υψόμετρο:

Μετατρέπουμε το Dem (aster_GGRS.tif) σε μορφή αναγνώσιμη για το GIMP (8-bit):

```
convert aster_GGRS.tif -evaluate multiply 26.54 -depth 8 new.tif
```

και το ανοίγουμε στο GIMP. Το επιλέγουμε και το αντιγράφουμε.

Στην συνέχεια στο GIMP, στο αρχείο όπου επεξεργαζόμαστε το ανάγλυφο (aster_GGRS.hillshade.z2.tif), δημιουργούμε ένα αντίγραφο του layer και σε αυτό προσθέτουμε μία Layer Mask από το  Layer->Mask->Add Layer Mask->Layers Alpha Channel. Στο mode ορίζουμε Multiply.

Κάνουμε paste into το layer με το DEM (aster_GGRS.tif) πάνω στο Duplicated Layer και στην συνέχεια με δεξί κλίκ Anchor Layer.

Τα layers στο GIMP πρέπει να είναι σε αυτή την μορφή:

![]({static}images/layers.jpg)


Πάνω στο Duplicated Layer κάνουμε με δεξί κλίκ Show Layer Mask και Edit Layer Mask. Βλέπουμε το layer δηλαδή το αρχείο DEM που χρησιμοποιειται για την διαφάνεια Alpha. Μπορούμε να τονίσουμε ακόμα περισσότερο τις κορυφές του αναγλύφου με τις εντολές Colors->Levels και Colors->Brightenest-Contrast και Colors->Auto->Stretch Contrast.


![]({static}images/alpha.jpg)

Έτσι επιτυγχάνουμε να τονίσουμε τους ορεινούς όγκους του αναγλύφου και την αίσθηση της οπτική θέασης αφ' ύψηλου. Όπως φαίνεται στην παρακάτω εικόνα η εφαρμογή της μάσκας στην σκίαση αναγλύφου έχει σαν αποτέλεσμα να καθιστά ορατά μόνο συγκεκριμένα τμήματα.


![]({static}images/alpha.png)

Το επόμενο βήμα είναι να προσθέσουμε το αρχείο aster_GGRS.x2.alt90.tif στο αρχείο μας σαν layer (File->Open as Layer) και να το μεταφέρουμε στην κορυφή της σειράς των layers.
![]({static}images/dem_alt90.jpg)


Τέλος του ορίζουμε μικρή τιμή διαφάνειας (π.χ. 20%), με δοκιμές φαίνεται ανάλογα το αποτέλεσμα της μίξης των layers. Το αρχείο αποθηκεύεται με την ονομασία final.tif
![]({static}images/dem_final.jpg)

Μετά το πέρας της διαδικασίας το αρχείο δεν έχει πλέον καμία γεωαναφορά και για να την επαναφέρουμε μπορούμε να εκμεταλλευτούμε τα αντίστοιχα δεδομένα από τα αρχεία εισόδου που χρησιμοποιήθηκαν και περιέχουν γεωγραφική εξάρτηση και πληροφορία. Αρκεί ένα από αυτά τα αρχεία για να εξάγουμε την σχετική πληροφορία και να την προσαρτήσουμε στο αρχείο της σκίασης με την προυπόθεση όμως ότι αυτό δεν έχει υποστεί αλλαγές στο μέγεθός του.Έστω ότι το αρχείο που χρησιμοποιούμε είναι το αρχικό αρχείο ψηφιακού μοντέλου εδάφους στο ΕΓΣΑ'87, το αρχείο aster_GGRS.tif

Οι εντολές που απαιτούνται είναι:

```
listgeo -tfw aster_GGRS.tif
listgeo aster_GGRS.tif&gt;projdef.txt
geotifcp -e aster_GGRS.tfw -g projdef.txt final.tif final.GGRS.tif
```

Με την πρώτη εντολή εξάγουμε τo αρχείο tfw από το  aster_GGRS.tif,
Με την δεύτερη εντολή εξάγουμε τα μεταδεδομένα του αρχείου aster_GGRS.tif και τέλος
Με την τρίτη εντολή επισυνάπτουμε το αρχείο tfw και τα μεταδεδομένα σε ένα νέο αρχείο σκίασης αναγλύφου.
Το τελικό στάδιο είναι να συγχωνεύσουμε την σκίαση αναγλύφου με το ψηφιακό μοντέλου εδάφους σε φυσικά χρώματα. Γι' αυτήν την διαδικασία απαιτείται μια παλέτα χρωμάτων κατηγοριοποιημένη σύμφωνα με κλάσεις του υψομέτρου. Για να φτιάξουμε την παλέτα απαιτείται να γνωρίζουμε το μέγιστο και το ελάχιστο υψόμετρο του αρχείου μας (μπορούμε να το αναζητήσουμε με: gdalinfo -mm aster_GGRS.tif) και ανάλογα το εύρος και το πλήθος των κλάσεων ορίζουμε τις τιμές ανά κλάση. Μία τέτοια παλέτα χρωμάτων φαίνεται παρακάτω:

```
0 216 242 254
0.001 110 220 110
900 240 250 160
1300 230 220 170
1900 220 220 220
2500 250 250 250
```

Για την αναπαραγωγή του νέου έγχρωμου DEM δίνουμε την παρακάτω εντολή:

```
gdaldem color-relief -co compress=lzw aster_GGRS.tif dem_ramp2 aster_GGRS-color2.tif
```

[βλέπε αρχείο dem_ramp2]({static}extra/dem_ramp2)


Η τελική συγχώνευση μπορεί να ολοκληρωθεί με την συμβολή διάφορων λογισμικών όπως το QGIS, ή το Tilemill ή ακόμα και με μία εντολή στο τερματικό μέσω του nik2img.py όπως:

nik2img.py mapnik.xml out.png -d 3273 4144 -e 153409.664 4320757.413 243762.891 4435155.143


[βλέπε αρχείο mapnik.xml]({static}extra/mapnik.xml)


όπου -d οι διαστάσεις της εικόνας σε εικονοστοιχεία και -e η έκταση του χάρτη σε μονάδες μέτρησης του ΕΓΣΑ'87 (μέτρα).
Το τελικό απότέλεσμα είναι το παρακάτω:


![]({static}images/out.jpg)